#!/bin/sh

settings=${srcdir}/tests/settings.yaml
tmp_settings=${srcdir}/tests/settings.test_star_map.yaml
cat ${settings} | sed 's/output-dir:.*/output-dir: test_star_map/g' > ${tmp_settings}

#samplesheet=${srcdir}/tests/test_star_map/sample_sheet.csv
samplesheet=${srcdir}/tests/sample_sheet.csv
tmp_samplesheet=${srcdir}/tests/sample_sheet.test_star_map.csv
head -n 2 ${samplesheet} > ${tmp_samplesheet}

# create symbolic links to preprocessed data that is required to run the specific rule

${srcdir}/pigx-rnaseq -s ${tmp_settings} --target star_map ${tmp_samplesheet} 

if ! test -f ${srcdir}/tests/test_star_map/mapped_reads/HBR_Rep1_Aligned.sortedByCoord.out.bam
then
  echo "ERROR: failed the STAR mapping test"
  exit 1
fi
 
rm ${tmp_settings} ${tmp_samplesheet}

