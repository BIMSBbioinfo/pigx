#!/bin/sh

settings=${srcdir}/tests/settings.yaml
tmp_settings=`mktemp "${srcdir}/tests/settings.tmp.XXXX.yaml"`
cat ${settings} | sed 's/output-dir:.*/output-dir: test_star_counts/g' > ${tmp_settings}

samplesheet=${srcdir}/tests/sample_sheet.csv

${srcdir}/pigx-rnaseq -s ${tmp_settings} --target star_counts ${samplesheet}

rm ${tmp_settings} ${tmp_samplesheet}

if ! test -f ${srcdir}/tests/test_star_counts/preprocessed_data/counts_from_STAR.tsv 
then
  echo "ERROR: failed obtaining counts matrix from STAR results"
  exit 1
fi
 

